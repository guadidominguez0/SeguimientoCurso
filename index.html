<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seguimiento del Curso - 52.5 horas</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c5aa0;
            text-align: center;
            margin-bottom: 20px;
            font-size: clamp(1.5rem, 4vw, 2.5rem);
        }
        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            background: #e8f4f8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .summary-item {
            text-align: center;
            min-width: 0;
        }
        .summary-item h3 {
            margin: 0;
            color: #2c5aa0;
            font-size: clamp(0.8rem, 2.5vw, 1rem);
        }
        .summary-item p {
            margin: 5px 0 0 0;
            font-size: clamp(1rem, 3vw, 1.2rem);
            font-weight: bold;
        }
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .chart-box {
            background: white;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            min-height: 250px;
        }
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }
        table {
            width: 100%;
            min-width: 900px;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            white-space: nowrap;
        }
        th {
            background-color: #2c5aa0;
            color: white;
            font-weight: bold;
            font-size: clamp(0.7rem, 2vw, 0.9rem);
        }
        td {
            font-size: clamp(0.7rem, 2vw, 0.85rem);
        }
        .week-header {
            background-color: #4a90e2 !important;
            color: white;
            font-weight: bold;
            text-align: center;
        }
        .completed {
            background-color: #d4edda;
        }
        .partial {
            background-color: #fff3cd;
        }
        .checkbox {
            transform: scale(1.2);
            margin-right: 5px;
        }
        .section-checkbox {
            transform: scale(1.1);
            margin: 2px;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            width: 0%;
            transition: width 0.3s ease;
        }
        .reset-btn {
            background-color: #ff6b6b;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 0;
            font-size: clamp(0.8rem, 2.5vw, 1rem);
        }
        .reset-btn:hover {
            background-color: #ff5252;
        }
        .section-number {
            font-weight: bold;
            color: #2c5aa0;
        }
        .section-item {
            display: block;
            margin: 3px 0;
            padding: 4px 6px;
            border-radius: 4px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            line-height: 1.3;
        }
        .section-item.completed {
            background-color: #d4edda;
            border-color: #28a745;
        }
        .sections-list {
            max-width: 250px;
            line-height: 1.3;
        }
        .day-percentage {
            font-weight: bold;
            color: #2c5aa0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>📚 Seguimiento del Curso - 52.5 horas en 30 días</h1>
        
        <div class="summary">
            <div class="summary-item">
                <h3>Total Secciones</h3>
                <p id="totalSections">67</p>
            </div>
            <div class="summary-item">
                <h3>Completadas</h3>
                <p id="completedSections">0</p>
            </div>
            <div class="summary-item">
                <h3>% Progreso</h3>
                <p id="progressPercentage">0%</p>
            </div>
            <div class="summary-item">
                <h3>Horas Completadas</h3>
                <p id="hoursCompleted">0h 0min</p>
            </div>
            <div class="summary-item">
                <h3>Horas Restantes</h3>
                <p id="hoursRemaining">52h 30min</p>
            </div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>

        <div class="charts-container">
            <div class="chart-box">
                <canvas id="progressChart"></canvas>
            </div>
        </div>

        <button class="reset-btn" onclick="resetProgress()">🔄 Reiniciar Progreso</button>

        <div class="table-container">
            <table id="courseTable">
                <thead>
                    <tr>
                        <th>✓</th>
                        <th>Día</th>
                        <th>Fecha</th>
                        <th>Secciones</th>
                        <th>Total Día</th>
                        <th>Porcentaje</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        const courseData = [
            {day: 1, sections: [{num: 1, duration: 63}, {num: 2, duration: 16}, {num: 3, duration: 31}], date: ''},
            {day: 2, sections: [{num: 4, duration: 26}, {num: 5, duration: 11}, {num: 6, duration: 7}, {num: 7, duration: 39}, {num: 8, duration: 49}], date: ''},
            {day: 3, sections: [{num: 9, duration: 55}, {num: 10, duration: 43}], date: ''},
            {day: 4, sections: [{num: 11, duration: 40}, {num: 12, duration: 37}, {num: 14, duration: 39}], date: ''},
            {day: 5, sections: [{num: 13, duration: 97}], date: ''},
            {day: 6, sections: [{num: 15, duration: 54}, {num: 17, duration: 47}], date: ''},
            {day: 7, sections: [{num: 16, duration: 83}, {num: 18, duration: 13}, {num: 19, duration: 31}], date: ''},
            {day: 8, sections: [{num: 20, duration: 6}, {num: 21, duration: 11}, {num: 22, duration: 26}, {num: 23, duration: 49}, {num: 24, duration: 21}], date: ''},
            {day: 9, sections: [{num: 25, duration: 76}, {num: 28, duration: 22}], date: ''},
            {day: 10, sections: [{num: 26, duration: 100}], date: ''},
            {day: 11, sections: [{num: 27, duration: 54}, {num: 29, duration: 22}, {num: 30, duration: 20}], date: ''},
            {day: 12, sections: [{num: 31, duration: 27}, {num: 33, duration: 23}, {num: 34, duration: 33}, {num: 35, duration: 27}], date: ''},
            {day: 13, sections: [{num: 32, duration: 69}, {num: 36, duration: 38}], date: ''},
            {day: 14, sections: [{num: 38, duration: 51}, {num: 39, duration: 39}], date: ''},
            {day: 15, sections: [{num: 37, duration: 99}], date: ''},
            {day: 16, sections: [{num: 41, duration: 25}, {num: 42, duration: 2}, {num: 43, duration: 4}, {num: 44, duration: 55}, {num: 49, duration: 16}], date: ''},
            {day: 17, sections: [{num: 40, duration: 136}], date: ''},
            {day: 18, sections: [{num: 45, duration: 43}, {num: 46, duration: 33}, {num: 50, duration: 16}], date: ''},
            {day: 19, sections: [{num: 47, duration: 43}, {num: 48, duration: 40}, {num: 51, duration: 45}], date: ''},
            {day: 20, sections: [{num: 52, duration: 54}, {num: 56, duration: 11}, {num: 57, duration: 23}], date: ''},
            {day: 21, sections: [{num: 54, duration: 87}, {num: 60, duration: 25}], date: ''},
            {day: 22, sections: [{num: 55, duration: 104}], date: ''},
            {day: 23, sections: [{num: 53, duration: 191}], date: ''},
            {day: 24, sections: [{num: 59, duration: 36}, {num: 63, duration: 59}], date: ''},
            {day: 25, sections: [{num: 58, duration: 132}], date: ''},
            {day: 26, sections: [{num: 62, duration: 108}], date: ''},
            {day: 27, sections: [{num: 61, duration: 164}], date: ''},
            {day: 28, sections: [{num: 65, duration: 65}, {num: 66, duration: 35}], date: ''},
            {day: 29, sections: [{num: 64, duration: 16}, {num: 67, duration: 1}], date: ''},
            {day: 30, sections: [], date: ''}
        ];

        let completedSections = new Set();
        let progressChart;

        function initializeApp() {
            generateDates();
            loadProgress();
            renderTable();
            updateSummary();
            createCharts();
            updateCharts();
        }

        function generateDates() {
            const startDate = new Date();
            let currentDate = new Date(startDate);

            for (let i = 0; i < courseData.length; i++) {
                if (courseData[i].sections.length > 0) {
                    while (currentDate.getDay() === 0 || currentDate.getDay() === 6) {
                        currentDate.setDate(currentDate.getDate() + 1);
                    }
                    courseData[i].date = currentDate.toLocaleDateString('es-ES');
                    currentDate.setDate(currentDate.getDate() + 1);
                } else {
                    courseData[i].date = 'Día libre';
                }
            }
        }

        function renderTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            let weekCounter = 1;
            let dayCounter = 0;

            courseData.forEach((dayData, index) => {
                if (dayData.sections.length === 0) return;

                if (dayCounter % 5 === 0) {
                    const weekRow = tbody.insertRow();
                    weekRow.innerHTML = `<td colspan="7" class="week-header">SEMANA ${weekCounter}</td>`;
                    weekCounter++;
                }

                const row = tbody.insertRow();
                const totalMinutes = dayData.sections.reduce((sum, section) => sum + section.duration, 0);
                const hours = Math.floor(totalMinutes / 60);
                const minutes = totalMinutes % 60;

                // Crear HTML para las secciones con checkboxes individuales
                const sectionsHtml = dayData.sections.map(s => {
                    const isCompleted = completedSections.has(s.num);
                    return `<div class="section-item ${isCompleted ? 'completed' : ''}">
                        <input type="checkbox" class="section-checkbox" ${isCompleted ? 'checked' : ''} 
                               onchange="toggleSection(${s.num})" id="section${s.num}">
                        <label for="section${s.num}" class="section-number">${s.num}</label>
                        <small>(${Math.floor(s.duration/60)}h ${s.duration%60}min)</small>
                    </div>`;
                }).join('');

                // Calcular progreso del día
                const completedSectionsInDay = dayData.sections.filter(s => completedSections.has(s.num)).length;
                const totalSectionsInDay = dayData.sections.length;
                const dayPercentage = Math.round((completedSectionsInDay / totalSectionsInDay) * 100);
                
                const allCompleted = dayPercentage === 100;
                const hasProgress = dayPercentage > 0;

                // Determinar clase CSS del row
                let rowClass = '';
                if (allCompleted) rowClass = 'completed';
                else if (hasProgress) rowClass = 'partial';

                // Estado del día
                let dayStatus = '';
                if (allCompleted) dayStatus = '✅ Completado';
                else if (hasProgress) dayStatus = `🔄 En progreso (${completedSectionsInDay}/${totalSectionsInDay})`;
                else dayStatus = '⏳ Pendiente';

                row.className = rowClass;
                row.innerHTML = `
                    <td><input type="checkbox" class="checkbox" ${allCompleted ? 'checked' : ''} 
                             onchange="toggleDay(${index})" ${hasProgress && !allCompleted ? 'indeterminate' : ''}></td>
                    <td><strong>Día ${dayData.day}</strong></td>
                    <td>${dayData.date}</td>
                    <td><div class="sections-list">${sectionsHtml}</div></td>
                    <td><strong>${hours}h ${minutes}min</strong></td>
                    <td><span class="day-percentage">${dayPercentage}%</span></td>
                    <td>${dayStatus}</td>
                `;

                // Establecer indeterminado si es necesario
                const dayCheckbox = row.querySelector('.checkbox');
                if (hasProgress && !allCompleted) {
                    dayCheckbox.indeterminate = true;
                }

                dayCounter++;
            });
        }

        function toggleSection(sectionNum) {
            if (completedSections.has(sectionNum)) {
                completedSections.delete(sectionNum);
            } else {
                completedSections.add(sectionNum);
            }

            renderTable();
            updateSummary();
            updateCharts();
            saveProgress();
        }

        function toggleDay(dayIndex) {
            const dayData = courseData[dayIndex];
            const allCompleted = dayData.sections.every(s => completedSections.has(s.num));

            if (allCompleted) {
                // Si está completo, desmarcar todas las secciones del día
                dayData.sections.forEach(section => completedSections.delete(section.num));
            } else {
                // Si no está completo, marcar todas las secciones del día
                dayData.sections.forEach(section => completedSections.add(section.num));
            }

            renderTable();
            updateSummary();
            updateCharts();
            saveProgress();
        }

        function updateSummary() {
            const totalSections = 67;
            const completed = completedSections.size;
            const percentage = Math.round((completed / totalSections) * 100);

            let totalCompletedMinutes = 0;
            completedSections.forEach(sectionNum => {
                courseData.forEach(day => {
                    const section = day.sections.find(s => s.num === sectionNum);
                    if (section) totalCompletedMinutes += section.duration;
                });
            });

            const completedHours = Math.floor(totalCompletedMinutes / 60);
            const completedMins = totalCompletedMinutes % 60;
            const remainingMinutes = 3150 - totalCompletedMinutes;
            const remainingHours = Math.floor(remainingMinutes / 60);
            const remainingMins = remainingMinutes % 60;

            document.getElementById('completedSections').textContent = completed;
            document.getElementById('progressPercentage').textContent = `${percentage}%`;
            document.getElementById('hoursCompleted').textContent = `${completedHours}h ${completedMins}min`;
            document.getElementById('hoursRemaining').textContent = `${remainingHours}h ${remainingMins}min`;
            document.getElementById('progressBar').style.width = `${percentage}%`;
        }

        function createCharts() {
            const ctx1 = document.getElementById('progressChart').getContext('2d');
            progressChart = new Chart(ctx1, {
                type: 'doughnut',
                data: {
                    labels: ['Completado', 'Pendiente'],
                    datasets: [{
                        data: [completedSections.size, 67 - completedSections.size],
                        backgroundColor: ['#4CAF50', '#E0E0E0'],
                        borderWidth: 0
                    }]
                },
                options: { 
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function updateCharts() {
            const completed = completedSections.size;
            const remaining = 67 - completed;
            progressChart.data.datasets[0].data = [completed, remaining];
            progressChart.update();
        }

        function resetProgress() {
            if (confirm('¿Estás seguro de que quieres reiniciar todo el progreso?')) {
                completedSections.clear();
                saveProgress();
                renderTable();
                updateSummary();
                updateCharts();
            }
        }

        function saveProgress() {
            localStorage.setItem('completedSections', JSON.stringify(Array.from(completedSections)));
        }

        function loadProgress() {
            const saved = localStorage.getItem('completedSections');
            if (saved) {
                completedSections = new Set(JSON.parse(saved));
            }
        }

        initializeApp();
    </script>
</body>
</html>