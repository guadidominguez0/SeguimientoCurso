<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seguimiento del Curso - 52.5 horas</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Seguimiento del Curso</h1>
        <p style="text-align: center; color: var(--text-light); margin-bottom: 30px;">52.5 horas en 30 días</p>
        
        <div class="summary">
            <div class="summary-item">
                <h3>Total Secciones</h3>
                <p id="totalSections">67</p>
            </div>
            <div class="summary-item">
                <h3>Completadas</h3>
                <p id="completedSections">0</p>
            </div>
            <div class="summary-item">
                <h3>Progreso</h3>
                <p id="progressPercentage">0%</p>
            </div>
            <div class="summary-item">
                <h3>Horas Completadas</h3>
                <p id="hoursCompleted">0h 0min</p>
            </div>
            <div class="summary-item">
                <h3>Horas Restantes</h3>
                <p id="hoursRemaining">52h 30min</p>
            </div>
        </div>

        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>
        </div>

        <div class="charts-container">
            <div class="chart-box">
                <canvas id="progressChart"></canvas>
            </div>
        </div>

        <button class="reset-btn" onclick="resetProgress()">Reiniciar Progreso</button>

        <div class="tabs-container">
            <div class="tabs-nav" id="tabsNav"></div>
            <div id="tabsContent"></div>
        </div>
    </div>

    <script>
        const courseData = [
            {day: 1, sections: [{num: 1, duration: 63}, {num: 2, duration: 16}, {num: 3, duration: 31}], date: ''},
            {day: 2, sections: [{num: 4, duration: 26}, {num: 5, duration: 11}, {num: 6, duration: 7}, {num: 7, duration: 39}, {num: 8, duration: 49}], date: ''},
            {day: 3, sections: [{num: 9, duration: 55}, {num: 10, duration: 43}], date: ''},
            {day: 4, sections: [{num: 11, duration: 40}, {num: 12, duration: 37}, {num: 14, duration: 39}], date: ''},
            {day: 5, sections: [{num: 13, duration: 97}], date: ''},
            {day: 6, sections: [{num: 15, duration: 54}, {num: 17, duration: 47}], date: ''},
            {day: 7, sections: [{num: 16, duration: 83}, {num: 18, duration: 13}, {num: 19, duration: 31}], date: ''},
            {day: 8, sections: [{num: 20, duration: 6}, {num: 21, duration: 11}, {num: 22, duration: 26}, {num: 23, duration: 49}, {num: 24, duration: 21}], date: ''},
            {day: 9, sections: [{num: 25, duration: 76}, {num: 28, duration: 22}], date: ''},
            {day: 10, sections: [{num: 26, duration: 100}], date: ''},
            {day: 11, sections: [{num: 27, duration: 54}, {num: 29, duration: 22}, {num: 30, duration: 20}], date: ''},
            {day: 12, sections: [{num: 31, duration: 27}, {num: 33, duration: 23}, {num: 34, duration: 33}, {num: 35, duration: 27}], date: ''},
            {day: 13, sections: [{num: 32, duration: 69}, {num: 36, duration: 38}], date: ''},
            {day: 14, sections: [{num: 38, duration: 51}, {num: 39, duration: 39}], date: ''},
            {day: 15, sections: [{num: 37, duration: 99}], date: ''},
            {day: 16, sections: [{num: 41, duration: 25}, {num: 42, duration: 2}, {num: 43, duration: 4}, {num: 44, duration: 55}, {num: 49, duration: 16}], date: ''},
            {day: 17, sections: [{num: 40, duration: 136}], date: ''},
            {day: 18, sections: [{num: 45, duration: 43}, {num: 46, duration: 33}, {num: 50, duration: 16}], date: ''},
            {day: 19, sections: [{num: 47, duration: 43}, {num: 48, duration: 40}, {num: 51, duration: 45}], date: ''},
            {day: 20, sections: [{num: 52, duration: 54}, {num: 56, duration: 11}, {num: 57, duration: 23}], date: ''},
            {day: 21, sections: [{num: 54, duration: 87}, {num: 60, duration: 25}], date: ''},
            {day: 22, sections: [{num: 55, duration: 104}], date: ''},
            {day: 23, sections: [{num: 53, duration: 191}], date: ''},
            {day: 24, sections: [{num: 59, duration: 36}, {num: 63, duration: 59}], date: ''},
            {day: 25, sections: [{num: 58, duration: 132}], date: ''},
            {day: 26, sections: [{num: 62, duration: 108}], date: ''},
            {day: 27, sections: [{num: 61, duration: 164}], date: ''},
            {day: 28, sections: [{num: 65, duration: 65}, {num: 66, duration: 35}], date: ''},
            {day: 29, sections: [{num: 64, duration: 16}, {num: 67, duration: 1}], date: ''}
        ];

        let completedSections = new Set();
        let progressChart;
        let currentWeek = 1;

        function initializeApp() {
            generateDates();
            loadProgress();
            createTabs();
            updateSummary();
            createCharts();
            updateCharts();
        }

        // Generar fechas a partir del 18/08/2025, saltando fines de semana
        function generateDates() {
            // Fecha de inicio fija: 18/08/2025
            const startDate = new Date('2025-08-18');
            let currentDate = new Date(startDate);

            for (let i = 0; i < courseData.length; i++) {
                if (courseData[i].sections.length > 0) {
                    // Saltar fines de semana
                    while (currentDate.getDay() === 0 || currentDate.getDay() === 6) {
                        currentDate.setDate(currentDate.getDate() + 1);
                    }
                    courseData[i].date = currentDate.toLocaleDateString('es-ES');
                    currentDate.setDate(currentDate.getDate() + 1);
                } else {
                    courseData[i].date = 'Día libre';
                }
            }
        }

        function createTabs() {
            const tabsNav = document.getElementById('tabsNav');
            const tabsContent = document.getElementById('tabsContent');
            
            tabsNav.innerHTML = '';
            tabsContent.innerHTML = '';

            // Crear 6 semanas (5 días laborales cada una)
            const weeks = [];
            let currentWeekDays = [];
            let dayCounter = 0;

            courseData.forEach((dayData, index) => {
                if (dayData.sections.length === 0) return;

                currentWeekDays.push(dayData);
                dayCounter++;

                if (dayCounter === 5 || index === courseData.length - 1) {
                    weeks.push([...currentWeekDays]);
                    currentWeekDays = [];
                    dayCounter = 0;
                }
            });

            weeks.forEach((week, weekIndex) => {
                // Crear botón de pestaña
                const tabButton = document.createElement('button');
                tabButton.className = `tab-button ${weekIndex === 0 ? 'active' : ''}`;
                tabButton.textContent = `Semana ${weekIndex + 1}`;
                tabButton.onclick = () => switchTab(weekIndex + 1);
                tabsNav.appendChild(tabButton);

                // Crear contenido de pestaña
                const tabContent = document.createElement('div');
                tabContent.className = `tab-content ${weekIndex === 0 ? 'active' : ''}`;
                tabContent.id = `week-${weekIndex + 1}`;

                const weekTitle = document.createElement('h2');
                weekTitle.className = 'week-title';
                weekTitle.textContent = `Semana ${weekIndex + 1}`;
                tabContent.appendChild(weekTitle);

                const daysGrid = document.createElement('div');
                daysGrid.className = 'days-grid';

                week.forEach(dayData => {
                    const dayCard = createDayCard(dayData);
                    daysGrid.appendChild(dayCard);
                });

                tabContent.appendChild(daysGrid);
                tabsContent.appendChild(tabContent);
            });
        }

        function createDayCard(dayData) {
            const totalMinutes = dayData.sections.reduce((sum, section) => sum + section.duration, 0);
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;

            // Calcular progreso del día
            const completedSectionsInDay = dayData.sections.filter(s => completedSections.has(s.num)).length;
            const totalSectionsInDay = dayData.sections.length;
            const dayPercentage = Math.round((completedSectionsInDay / totalSectionsInDay) * 100);
            
            const allCompleted = dayPercentage === 100;
            const hasProgress = dayPercentage > 0;

            const dayCard = document.createElement('div');
            dayCard.className = `day-card ${allCompleted ? 'completed' : hasProgress ? 'partial' : ''}`;

            // Header del día
            const dayHeader = document.createElement('div');
            dayHeader.className = 'day-header';

            const dayInfo = document.createElement('div');
            dayInfo.className = 'day-info';
            dayInfo.innerHTML = `
                <h3>Día ${dayData.day}</h3>
                <p>${dayData.date} • ${hours}h ${minutes}min</p>
            `;

            const dayStatus = document.createElement('div');
            dayStatus.className = 'day-status';

            // Checkbox del día
            const dayCheckbox = document.createElement('input');
            dayCheckbox.type = 'checkbox';
            dayCheckbox.className = 'day-checkbox';
            dayCheckbox.checked = allCompleted;
            if (hasProgress && !allCompleted) {
                dayCheckbox.indeterminate = true;
            }
            dayCheckbox.onchange = () => toggleDay(dayData);

            // Badge de estado
            const statusBadge = document.createElement('span');
            statusBadge.className = `status-badge ${
                allCompleted ? 'status-completed' : 
                hasProgress ? 'status-partial' : 'status-pending'
            }`;
            statusBadge.textContent = 
                allCompleted ? 'Completado' : 
                hasProgress ? `${completedSectionsInDay}/${totalSectionsInDay}` : 'Pendiente';

            dayStatus.appendChild(dayCheckbox);
            dayStatus.appendChild(statusBadge);

            dayHeader.appendChild(dayInfo);
            dayHeader.appendChild(dayStatus);

            // Barra de progreso del día
            const dayProgress = document.createElement('div');
            dayProgress.className = 'day-progress';

            const dayProgressBar = document.createElement('div');
            dayProgressBar.className = 'day-progress-bar';

            const dayProgressFill = document.createElement('div');
            dayProgressFill.className = 'day-progress-fill';
            dayProgressFill.style.width = `${dayPercentage}%`;

            const dayProgressText = document.createElement('div');
            dayProgressText.className = 'day-progress-text';
            dayProgressText.textContent = `${completedSectionsInDay} de ${totalSectionsInDay} secciones completadas (${dayPercentage}%)`;

            dayProgressBar.appendChild(dayProgressFill);
            dayProgress.appendChild(dayProgressBar);
            dayProgress.appendChild(dayProgressText);

            // Contenedor de secciones
            const sectionsContainer = document.createElement('div');
            sectionsContainer.className = 'sections-container';

            dayData.sections.forEach(section => {
                const sectionItem = document.createElement('div');
                sectionItem.className = `section-item ${completedSections.has(section.num) ? 'completed' : ''}`;
                sectionItem.onclick = () => toggleSection(section.num);

                const sectionCheckbox = document.createElement('input');
                sectionCheckbox.type = 'checkbox';
                sectionCheckbox.className = 'section-checkbox';
                sectionCheckbox.checked = completedSections.has(section.num);
                sectionCheckbox.onclick = (e) => e.stopPropagation();
                sectionCheckbox.onchange = () => toggleSection(section.num);

                const sectionInfo = document.createElement('div');
                sectionInfo.className = 'section-info';
                sectionInfo.innerHTML = `
                    <div class="section-number">Sección ${section.num}</div>
                    <div class="section-duration">${Math.floor(section.duration/60)}h ${section.duration%60}min</div>
                `;

                sectionItem.appendChild(sectionCheckbox);
                sectionItem.appendChild(sectionInfo);
                sectionsContainer.appendChild(sectionItem);
            });

            dayCard.appendChild(dayHeader);
            dayCard.appendChild(dayProgress);
            dayCard.appendChild(sectionsContainer);

            return dayCard;
        }

        function switchTab(weekNumber) {
            // Actualizar botones
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-button')[weekNumber - 1].classList.add('active');

            // Actualizar contenido
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`week-${weekNumber}`).classList.add('active');

            currentWeek = weekNumber;
        }

        function toggleSection(sectionNum) {
            if (completedSections.has(sectionNum)) {
                completedSections.delete(sectionNum);
            } else {
                completedSections.add(sectionNum);
            }

            createTabs(); // Recrear tabs para actualizar estados
            switchTab(currentWeek); // Mantener la pestaña actual
            updateSummary();
            updateCharts();
            saveProgress();
        }

        function toggleDay(dayData) {
            const allCompleted = dayData.sections.every(s => completedSections.has(s.num));

            if (allCompleted) {
                // Si está completo, desmarcar todas las secciones del día
                dayData.sections.forEach(section => completedSections.delete(section.num));
            } else {
                // Si no está completo, marcar todas las secciones del día
                dayData.sections.forEach(section => completedSections.add(section.num));
            }

            createTabs(); // Recrear tabs para actualizar estados
            switchTab(currentWeek); // Mantener la pestaña actual
            updateSummary();
            updateCharts();
            saveProgress();
        }

        function updateSummary() {
            const totalSections = 67;
            const completed = completedSections.size;
            const percentage = Math.round((completed / totalSections) * 100);

            let totalCompletedMinutes = 0;
            completedSections.forEach(sectionNum => {
                courseData.forEach(day => {
                    const section = day.sections.find(s => s.num === sectionNum);
                    if (section) totalCompletedMinutes += section.duration;
                });
            });

            const completedHours = Math.floor(totalCompletedMinutes / 60);
            const completedMins = totalCompletedMinutes % 60;
            const remainingMinutes = 3150 - totalCompletedMinutes;
            const remainingHours = Math.floor(remainingMinutes / 60);
            const remainingMins = remainingMinutes % 60;

            document.getElementById('completedSections').textContent = completed;
            document.getElementById('progressPercentage').textContent = `${percentage}%`;
            document.getElementById('hoursCompleted').textContent = `${completedHours}h ${completedMins}min`;
            document.getElementById('hoursRemaining').textContent = `${remainingHours}h ${remainingMins}min`;
            document.getElementById('progressBar').style.width = `${percentage}%`;
        }

        function createCharts() {
            const ctx1 = document.getElementById('progressChart').getContext('2d');
            progressChart = new Chart(ctx1, {
                type: 'doughnut',
                data: {
                    labels: ['Completado', 'Pendiente'],
                    datasets: [{
                        data: [completedSections.size, 67 - completedSections.size],
                        backgroundColor: ['#3E6D52', '#e8e6e0'],
                        borderWidth: 0,
                        borderRadius: 4
                    }]
                },
                options: { 
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: {
                                    family: 'Segoe UI'
                                },
                                color: '#3a3a3a'
                            }
                        }
                    }
                }
            });
        }

        function updateCharts() {
            const completed = completedSections.size;
            const remaining = 67 - completed;
            progressChart.data.datasets[0].data = [completed, remaining];
            progressChart.update();
        }

        function resetProgress() {
            if (confirm('¿Estás seguro de que quieres reiniciar todo el progreso?')) {
                completedSections.clear();
                saveProgress();
                createTabs();
                switchTab(1);
                updateSummary();
                updateCharts();
            }
        }

        function saveProgress() {
            const progressData = Array.from(completedSections);
            localStorage.setItem("courseProgress", JSON.stringify(progressData));
        }

        function loadProgress() {
            const saved = localStorage.getItem("courseProgress");
            if (saved) {
                completedSections = new Set(JSON.parse(saved));
            }
        }

        initializeApp();
    </script>
</body>
</html>